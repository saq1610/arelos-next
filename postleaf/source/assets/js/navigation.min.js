/* globals Nanobar, Postleaf, Sortable */
$(function(){"use strict";function a(a,e){var t=$(".navigation-template").html();$(t).find(".label-input").val(a).end().find(".link-input").val(e).end().appendTo(".navigation-list")}var e=new Nanobar;$(".navigation-form").on("submit",function(a){var t=this,n=!0;a.preventDefault(),$(".navigation-form .label-input").each(function(){var a=$(this).closest(".navigation-list-item"),e=""===$(this).val();e?($(a).closest(".navigation-list-item").addClass("has-warning").velocity("callout.shake"),n=!1):$(a).removeClass("has-warning")}),n&&(e.go(50),$.ajax({url:Postleaf.url("api/navigation"),type:"PUT",data:$(t).serialize()}).done(function(a){a.success?Postleaf.announce($('meta[name="postleaf:language"]').attr("data-changes-saved"),{style:"success"}):$.alertable.alert(a.message)}).always(function(){e.go(100)}))}),$(".add-format").on("change",function(){var a=$(this).find(":selected").get(0),e=$(a).val(),t=$(a).attr("data-placeholder");$(".add-link").prop("placeholder",t).prop("disabled",e.indexOf("%")===-1)}).trigger("change"),$(".add-form").on("submit",function(e){var t=$(".add-format").val(),n=$(".add-format").find(":selected").attr("data-formatter"),i=$.trim($(".add-label").val()),l=$.trim($(".add-link").val());if(e.preventDefault(),!i.length||t.indexOf("%")>-1&&!l.length)return void $(".add-form").addClass("has-warning").velocity("callout.shake");switch($(".add-form").removeClass("has-warning"),n){case"slug":l=Postleaf.slug(l);break;case"encode":l=l.replace("/"," ").replace("\\"," "),l=encodeURIComponent(l)}l=t.replace("%",l),a(i,l),$(".add-label, .add-link").val(""),$(".add-format").find("option:first").prop("selected",!0).end().trigger("change")}),$(".navigation-list").on("click",".delete",function(){var a=$(this).closest(".navigation-list-item");$(a).remove()}),$(".submit").on("click",function(){$(".navigation-form").submit()}),Sortable.create($(".navigation-list").get(0),{animation:150,handle:".handle",draggable:".navigation-list-item"})});